#安装bazel https://docs.bazel.build/versions/master/install-ubuntu.html
```shell
Step 1: Download Bazel
proxychains wget https://github.com/bazelbuild/bazel/releases/download/0.12.0/bazel-0.12.0-installer-linux-x86_64.sh
Step 2: Run the installer
chmod +x bazel-<version>-installer-linux-x86_64.sh
./bazel-<version>-installer-linux-x86_64.sh --user
##The --user flag installs Bazel to the $HOME/bin directory on your system and sets the .bazelrc path to $HOME/.bazelrc. Use the --help command to see additional installation options.##
#source /home/qiujie/.bazel/bin/bazel-complete.bash 这句话加到～/.bashrc可以试试#
Step 3: Set up your environment<br>
##If you ran the Bazel installer with the --user flag as above, the Bazel executable is installed in your $HOME/bin directory. It's a good idea to add this directory to your default paths, as follows:##
export PATH="$PATH:$HOME/bin"##必须有才可以##
Step 4:
source ~/.bashrc
```
bazel：https://blog.csdn.net/elaine_bao/article/details/78668657
几点理解：BUILD是把文件依赖关系写清楚
bazel build -c编译。(注意这里是平行相对WORKSPACE地址)bazel-bin/运行(在进入有bazel-bin的文件下，执行地址也是平行相对的地址)。

开始：引用https://github.com/tensorflow/models/tree/master/research/skip_thoughts
### 1Prepare the Training Data
路径/home/qiujie/model/skipthoughts/...<br>
数据/home/qiujie/model/skipthoughts/bookcorpus-->/home/qiujie/model/skipthoughts/data<br>
/home/qiujie/model/bazel-bin<br>
```shell
#each sentence is already tokenized.
INPUT_FILES="${HOME}/model/skip_thoughts/bookcorpus/*.txt"#实际地址
#Location to save the preprocessed training and validation data.
DATA_DIR="${HOME}/model/skip_thoughts/data"
#Build the preprocessing script.
cd model/skip_thoughts
bazel build -c opt //skip_thoughts/data:preprocess_dataset#注意这里是平行相对WORKSPACE地址
source activate tensorflow
bazel-bin/skip_thoughts/data/preprocess_dataset   --input_files=${INPUT_FILES}   --output_dir=${DATA_DIR}#也是相对地址
```
### 2Run the Training Script
```shell
# Directory containing the preprocessed data.
DATA_DIR="${HOME}/model/skip_thoughts/data"

# Directory to save the model.
MODEL_DIR="${HOME}/model/skip_thoughts/save_model"

# Build the model.
cd model
bazel build -c opt //skip_thoughts/...#编译BUILD里面所有文件

# Run the training script.#在model（进入有bazel-bin的目录下）
source activate tensorflow
bazel-bin/skip_thoughts/train   --input_file_pattern="${DATA_DIR}/train-?????-of-00100"   --train_dir="${MODEL_DIR}/train"
 ```
### 3Track Training Progress
```shell
DATA_DIR="${HOME}/model/skip_thoughts/data"
MODEL_DIR="${HOME}/model/skip_thoughts/save_model"

export CUDA_VISIBLE_DEVICES="0,1"

bazel-bin/skip_thoughts/track_perplexity \
  --input_file_pattern="${DATA_DIR}/validation-?????-of-00001" \
  --checkpoint_dir="${MODEL_DIR}/train" \
  --eval_dir="${MODEL_DIR}/val" \
  --num_eval_examples=50000

If you started the track_perplexity script, run a TensorBoard server in a separate process for real-time monitoring of training summaries and validation perplexity.
# Run a TensorBoard server.
MODEL_DIR="${HOME}/model/skip_thoughts/save_model"
tensorboard --logdir="${MODEL_DIR}"
```
### 4Evaluating a Model
```shell
Download Pretrained Models
# Directory to download the pretrained models to.
PRETRAINED_MODELS_DIR="${HOME}/model/skip_thoughts/pretrained/"

mkdir -p ${PRETRAINED_MODELS_DIR}
cd ${PRETRAINED_MODELS_DIR}

# Download and extract the unidirectional model.
wget "http://download.tensorflow.org/models/skip_thoughts_uni_2017_02_02.tar.gz"
tar -xvf skip_thoughts_uni_2017_02_02.tar.gz
rm skip_thoughts_uni_2017_02_02.tar.gz
```
#### Preparation
```shell
ST_KIROS_DIR="${HOME}/model/skip_thoughts/skipthoughts_kiros"
proxychains git clone https://github.com/ryankiros/skip-thoughts.git "${ST_KIROS_DIR}/skipthoughts"
# Make the package importable.
export PYTHONPATH="${ST_KIROS_DIR}/:${PYTHONPATH}"
```
#### CR (customer review)
```shell
proxychains wget http://www.stanford.edu/~sidaw/projects/data_NB_ACL12.zip
unzip data_NB_ACL12.zip
cp custrev.neg /home/qiujie/model/skip_thoughts/eval_data/
cp custrev.pos /home/qiujie/model/skip_thoughts/eval_data/
###Run the Evaluation Tasks
# Path to checkpoint file or a directory containing checkpoint files (the script
# will select the most recent).
CHECKPOINT_PATH="${HOME}/model/skip_thoughts/pretrained/skip_thoughts_uni_2017_02_02"

# Vocabulary file generated by the vocabulary expansion script.
VOCAB_FILE="${HOME}/model/skip_thoughts/pretrained/skip_thoughts_uni_2017_02_02/vocab.txt"

# Embeddings file generated by the vocabulary expansion script.
EMBEDDINGS_FILE="${HOME}/model/skip_thoughts/pretrained/skip_thoughts_uni_2017_02_02/embeddings.npy"

# Directory containing files custrev.pos and custrev.neg.
EVAL_DATA_DIR="${HOME}/model/skip_thoughts/eval_data"

# Build the evaluation script.
cd tensorflow-models/skip_thoughts
bazel build -c opt //skip_thoughts:evaluate

# Run the evaluation script.
bazel-bin/skip_thoughts/evaluate \
  --eval_task=CR \
  --data_dir=${EVAL_DATA_DIR} \
  --uni_vocab_file=${VOCAB_FILE} \
  --uni_embeddings_file=${EMBEDDINGS_FILE} \
  --uni_checkpoint_path=${CHECKPOINT_PATH}
```


